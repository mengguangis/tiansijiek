<html>
<head>
<meta charset ="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1"> 
<title>Deferred Shader</title>
</head>

<body>
<canvas id="canvas" style="border: none;" width="720" height="720" tabindex="1"></canvas>
<script type = "text/javascript" src="js/gl-matrix.js"></script>
<script type = "x-shader/x-vertex" id = "quadvs">
	attribute vec3 Position;
	attribute vec2 Texcoord;

	varying vec2 fs_Texcoord;
	void main(void){
		fs_Texcoord = Texcoord;
		gl_Position = vec4(Position,1.0);
	}
</script>
<script type="x-shader/x-fragment" id = "quadfs">
	precision mediump float;
	uniform int u_Displaymode;

	uniform sampler2D u_NormalSampler;
	uniform sampler2D u_ColorSampler;
	uniform sampler2D u_PositionSampler;
	uniform sampler2D u_DepthSampler;	

	uniform vec3 u_LightPos;
	uniform float u_LightIntensity;

	varying vec2 fs_Texcoord;

	void main(void)
	{
		vec4 position = texture2D(u_PositionSampler,fs_Texcoord);
		vec3 color = texture2D(u_ColorSampler,fs_Texcoord).rgb;
		vec3 normal = texture2D(u_NormalSampler,fs_Texcoord).rgb;	
		normal = normalize(normal);
		if(u_Displaymode == 0){
			//display normal
			gl_FragColor = texture2D(u_NormalSampler,fs_Texcoord);
			return;
		}
		else if(u_Displaymode == 1){
			//display color
			gl_FragColor = texture2D(u_ColorSampler,fs_Texcoord);
			return;
		}
		else if(u_Displaymode == 2)
		{
			//position
			gl_FragColor = texture2D(u_PositionSampler,fs_Texcoord);
			return;
		}
		else if(u_Displaymode == 3)
		{
			gl_FragColor = texture2D(u_DepthSampler,fs_Texcoord);
			return;
		}
		else if(u_Displaymode == 4){
			//diffise
			float diffuse = max(dot(normalize(u_LightPos - position.xyz),normal),0.0);
			vec3 diffuseColor = diffuse * u_LightIntensity * vec3(1.0,1.0,1.0) * color;
			gl_FragColor = vec4(diffuseColor,1.0);
			return;
		}
		else
		{
			gl_FragColor = vec4(1.0,0.0,0.0,1.0);
			return;
		}
	}

</script>
<script type="x-shader/x-vertex" id = "vs">
	uniform mat4 u_Model;
	uniform mat4 u_View;
	uniform mat4 u_Persp;
	uniform mat4 u_Inverse; 
	


	attribute vec3 Position;
	attribute vec2 Texcood;
	attribute vec3 Normal;

	varying vec2 vTexcoord;
	varying vec3 vNormal;
	varying vec4 vPosition;
	void main(void) {
		vec4 world = u_Model * vec4(Position,1.0);
		vec4 camera = u_View * world;
		vPosition = camera;
		gl_Position = u_Persp * camera;
		vTexcoord = Texcood;
		vNormal = (u_Inverse * vec4(Normal,0.0)).xyz;		 
	}
</script>
<script type="x-shader/x-fragment" id = "fs">
	precision mediump float; // have to add this, dont' exactly know why

	uniform sampler2D u_ColorSampler;
	
	uniform int u_Displaymode;


	varying vec2 vTexcoord;
	varying vec3 vNormal;
	varying vec4 vPosition;
	void main(void) {
		if(u_Displaymode == 0)
		{
			//display normal
			gl_FragColor = vec4(abs(vNormal),1.0);	
			return;
		}
		else if(u_Displaymode == 1)
		{
			//diaplay color
			gl_FragColor = texture2D(u_ColorSampler,vTexcoord);	
			return;			
		}
		else if(u_Displaymode == 2)
		{
			//display screen space position
			gl_FragColor = vec4(abs(vPosition).xyz,1.0);
			return;
		}
		else if(u_Displaymode == 3)
		{
			//depth
			gl_FragColor = vec4(1.0,1.0,0.0,1.0);
			return;
		}
		else
		{
			gl_FragColor = vec4(0.0,0.0,0.0,1.0);
			return;
		}
	}
</script>

<script src="js/webGLUtility.js"></script> 
<script type = "text/javascript" src="js/index.js"></script>

</body>

</html>
